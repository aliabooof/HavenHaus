<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Cart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script type="module">
        import {GetCartByID, GetProductByID} from "../js/db.js"
        import {GetUrlField, IncreaseQuantity, DecreaseQuantity, redirect} from "../js/util.js"
        let cartID = GetUrlField("id")
        if(!cartID) redirect("./not-found.html");
        
        let cart = GetCartByID(cartID)
        let itemsContainer;
       
        // function IncreaseQuantity(event){
        //         IQ(event,product.stock)
        // }

        function CreateDisplyCartItem(cartItem){
            let product = GetProductByID(cartItem.productID)[0];
            
            let cartString = `<div class="card mb-3">
                                    <div class="row g-0 align-items-center">
                                        <div class="col-4">
                                            <img src="../assets/images/banner.jpeg" class="img-fluid rounded-start" alt="Product">
                                        </div>
                                        <div class="col-8">
                                            <div class="card-body">
                                                <h5 class="card-title mb-1">${product.name}</h5>
                                                <p class="card-text text-muted mb-2">${product.desc}</p>
                                                <p class="card-text fw-bold text-primary">
                                                    <span class="fas fa-dollar-sign"></span>${product.price}
                                                </p>

                                                <div class="d-flex align-items-center">
                                                    <button class="decreaseQuantityBtn btn btn-outline-secondary btn-sm me-2">âˆ’</button>
                                                    <span class ="quantity">${cartItem.quantity}</span>
                                                    <button class="increaseQuantityBtn btn btn-outline-secondary btn-sm ms-2">+</button>
                                                    <button class="btn btn-link text-danger ms-auto">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                    <span class="d-none stock">${product.stock}</span>
                                                </div>
                                                <div> <span class="small">Stock: ${product.stock}</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                `
            const parser = new DOMParser();
            let cartDiv = parser.parseFromString(cartString, 'text/html');
            cartDiv = cartDiv.body.firstElementChild;
            cartDiv.querySelector(".increaseQuantityBtn").addEventListener("click",IncreaseQuantity)
            cartDiv.querySelector(".decreaseQuantityBtn").addEventListener("click",DecreaseQuantity)
            return cartDiv;
        }
        // console.log(cart)
        function DispalyCartItems(){
            cart.forEach(cartItem => {
                itemsContainer.appendChild( CreateDisplyCartItem(cartItem) )
            });
        }


        window.addEventListener("load",function(event){
                itemsContainer = document.getElementById("items-container");
                DispalyCartItems();
            })
    </script>
</head>

<body>

    <!-- Start of the Code -->
    <div class="container bg-gray p-4 rounded-4 shadow-sm">
        <div class="row">
            <h2 class="mb-4 fw-bold">Shopping Cart</h2>
            <!-- Products in your cart -->
            <div id="items-container" class="col-lg-8 col-12 mb-4">
                <!-- Cart Items Added here -->
                
            </div>
            <!-- Order Summary -->
            <div class="col-lg-4 col-12">
                <div class="card p-4 shadow-sm rounded-4">
                    <h4 class="mb-4 fw-bold">Order Details</h4>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal</span>
                        <span>$1399.98</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Shipping</span>
                        <span class="text-success">Free</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-3">
                        <strong>Total</strong>
                        <strong>$1399.98</strong>
                    </div>
                    <button class="btn btn-primary w-100 rounded-pill">Checkout</button>
                </div>
                <div class="text-center mt-4">
                    <a href="../index.html" class="btn btn-secondary">Continue Shopping</a>
                </div>
            </div>
        </div>
    </div>
    <!-- End of the Code -->

</body>

</html>